<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <title>මාසික චක්‍රය</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-pink-50 min-h-screen flex flex-col items-center p-4">

    <div class="w-full max-w-2xl">
        <h1 class="text-3xl font-bold text-pink-700 mb-6 text-center">මාසික චක්‍ර නියාමනය</h1>

        <!-- නව දත්ත ඇතුල් කිරීම -->
        <div class="bg-white rounded-2xl shadow-md p-6 mb-6">
            <h3 class="text-lg font-semibold mb-3">නව ආරම්භ දිනයක් ඇතුල් කරන්න</h3>
            <form method="POST" class="flex gap-3">
                <input type="date" name="start_date" required
                       class="border rounded-lg px-3 py-2 flex-1">
                <button type="submit"
                        class="bg-pink-600 text-white px-4 py-2 rounded-lg hover:bg-pink-700 transition">
                    ඇතුල් කරන්න
                </button>
            </form>
        </div>

        <!-- දත්ත පෙන්වීම -->
        <div class="bg-white rounded-2xl shadow-md p-6 mb-6">
            <h3 class="text-lg font-semibold mb-3">ඇතුල් කළ දිනයන්</h3>
            {% if dates %}
                <ul class="list-disc pl-6">
                    {% for d in dates %}
                        <li>{{ d }}</li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="text-gray-500">තවමත් කිසිදු දත්තයක් ඇතුල් කර නැත.</p>
            {% endif %}
        </div>

        <!-- සාමාන්‍ය චක්‍ර දිග -->
        <div class="bg-white rounded-2xl shadow-md p-6 mb-6">
            <h3 class="text-lg font-semibold mb-3">සාමාන්‍ය චක්‍ර දිග</h3>
            {% if avg_cycle %}
                <p class="text-pink-700 font-bold">{{ avg_cycle }} දින</p>
            {% else %}
                <p class="text-gray-500">තවම ගණනය කිරීමට තොරතුරු ප්‍රමාණවත් නැත.</p>
            {% endif %}
        </div>

        <!-- අලුත් මාසික ආරම්භ දින -->
        <div class="bg-white rounded-2xl shadow-md p-6 mb-6">
            <h3 class="text-lg font-semibold mb-3">ඉදිරි මාසික ආරම්භ දිනය</h3>
            {% if next_period %}
                <p class="text-pink-700 font-bold">{{ next_period }}</p>
            {% else %}
                <p class="text-gray-500">තවමත් ගණනය කළ නොහැක.</p>
            {% endif %}
        </div>

        <!-- ආරක්ෂිත සහ ඵලදායි කාලය -->
        <div class="bg-white rounded-2xl shadow-md p-6 mb-6">
            <h3 class="text-lg font-semibold mb-3">ආරක්ෂිත / ඵලදායි කාලයන්</h3>
            {% if safe_periods %}
                <p><b>ආරක්ෂිත (පෙර):</b> {{ safe_periods[0][0] }} - {{ safe_periods[0][1] }}</p>
                <p><b>ඵලදායි කාලය:</b> {{ safe_periods[1][0] }} - {{ safe_periods[1][1] }}</p>
                <p><b>ආරක්ෂිත (පසු):</b> {{ safe_periods[2][0] }} - {{ safe_periods[2][1] }}</p>
            {% else %}
                <p class="text-gray-500">තවමත් ගණනය කළ නොහැක.</p>
            {% endif %}
        </div>

        <!-- අනියමිත චක්‍රය -->
        {% if irregular_alert %}
            <div class="bg-red-100 border border-red-300 text-red-700 rounded-2xl p-4 mb-6">
                ⚠️ {{ irregular_alert }}
            </div>
        {% endif %}

        <!-- Chart -->
        <div class="bg-white rounded-2xl shadow-md p-6 mb-6">
            <h3 class="text-lg font-semibold mb-3">චක්‍ර දිග ගණනය</h3>
            <canvas id="cycleChart"></canvas>
        </div>
    </div>

    <script>
        const chartData = {{ chart_data | safe }};
        const ctx = document.getElementById('cycleChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: chartData.labels,
                datasets: [{
                    label: 'චක්‍ර දිග (දින)',
                    data: chartData.cycles,
                    borderColor: 'rgb(219, 39, 119)',
                    backgroundColor: 'rgba(219, 39, 119, 0.2)',
                    fill: true,
                    tension: 0.3,
                    pointRadius: 4,
                    pointBackgroundColor: 'rgb(219, 39, 119)'
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: true }
                },
                scales: {
                    y: { beginAtZero: false }
                }
            }
        });
    </script>

</body>
</html>
